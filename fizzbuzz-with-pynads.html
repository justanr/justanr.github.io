<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Alec Nikolas Reiter" />
        <meta name="copyright" content="Alec Nikolas Reiter" />

        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <link rel="stylesheet" href="/theme/slicknav.css">
        <script src="/theme/jquery.slicknav.min.js"></script>
        <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
        <script type="text/javascript"
            src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
        <!--[if lt IE 9]>
        <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
        <![endif]-->


<meta name="keywords" content="python, pynads, haskell, libraries, " />
        <title>Fizzbuzz With&nbsp;Pynads! - from alec.thoughts import *
</title>
        <link href="http://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://justanr.github.io/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://justanr.github.io/theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="http://justanr.github.io/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="http://justanr.github.io/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="http://justanr.github.io/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="http://justanr.github.io/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="http://justanr.github.io/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="http://justanr.github.io/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="http://justanr.github.io/theme/images/apple-touch-icon-144x144.png" />
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-64904436-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://justanr.github.io/"><span class=site-name>from alec.thoughts import *</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://justanr.github.io">Home</a></li>
                            <li ><a href="http://justanr.github.io/categories.html">Categories</a></li>
                            <li ><a href="http://justanr.github.io/tags.html">Tags</a></li>
                            <li ><a href="http://justanr.github.io/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://justanr.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="http://justanr.github.io/fizzbuzz-with-pynads"> Fizzbuzz With&nbsp;Pynads!  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            <pre class="code ipython3 literal-block">
<span class="kn">from</span> <span class="nn">pynads</span> <span class="k">import</span> <span class="n">Writer</span>
<span class="kn">from</span> <span class="nn">pynads.funcs</span> <span class="k">import</span> <span class="n">multibind</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">repeat</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>

<span class="n">pairs</span> <span class="o">=</span> <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'fizz'</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'buzz'</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">fizzer</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">pairs</span><span class="p">):</span>
    <span class="n">fizzed</span> <span class="o">=</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">buzz</span> <span class="k">for</span> <span class="n">fizz</span><span class="p">,</span> <span class="n">buzz</span> <span class="ow">in</span> <span class="n">pairs</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="o">%</span> <span class="n">fizz</span><span class="p">])</span> <span class="ow">or</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">Writer</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span><span class="n">fizzed</span><span class="p">})</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">multibind</span><span class="p">(</span><span class="n">Writer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{}),</span> <span class="o">*</span><span class="n">repeat</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">fizzer</span><span class="p">,</span> <span class="n">pairs</span><span class="o">=</span><span class="n">pairs</span><span class="p">),</span> <span class="mi">15</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Writer(16, {1: 1, 2: 2, 3: 'buzz', 4: 4, 5: 'fizz', 6: 'buzz', 7: 7, 8: 8, 9: 'buzz', 10: 'fizz', 11: 11, 12: 'buzz', 13: 13, 14: 14, 15: 'fizzbuzz'})
</pre>
<p>Truly an 11x Developer solution to the [<span class="caps">STRIKEOUT</span>:world&#8217;s] universe&#8217;s
premier code interview&nbsp;question!</p>
<div class="section" id="what-is-pynads">
<h2>What is&nbsp;&#8220;pynads&#8221;</h2>
<p>All joking aside, I&#8217;ve been hacking together a collection of
Haskell-esque tools for Python over the last few weeks. It started as a
&#8220;Well, I&#8217;ll learn Haskell better this way.&#8221; and has become&#8230;well,
honestly a tool for me learning Haskell&nbsp;still.</p>
<p><a class="reference external" href="https://github.com/justanr/pynads">Check it out</a>, I think it&#8217;s&nbsp;nifty.</p>
</div>
<div class="section" id="a-quick-tour-of-pynads">
<h2>A Quick Tour of&nbsp;Pynads</h2>
<p>pynads strives to be a pythonic form of Haskell. Which is buzzword for I
did some stuff.&nbsp;There&#8217;s:</p>
<ul class="simple">
<li>Functors</li>
<li>Applicatives</li>
<li>Monads</li>
<li>Monoids</li>
<li>Helpers</li>
</ul>
<p>All of the base classes are implemented as Abstract Base Classes which
makes inheritance easy. Well, that&#8217;s a lie, the root object of pynads is
a concrete class that just serves as an endpoint for <tt class="docutils literal">__new__</tt> and
<tt class="docutils literal">__init__</tt>.</p>
<div class="section" id="container">
<h3>Container</h3>
<p><tt class="docutils literal">pynads.Container</tt> is the root object of every <tt class="docutils literal">pynads</tt> class. It
serves as a final endpoint for <tt class="docutils literal">__new__</tt> and <tt class="docutils literal">__init__</tt> as well as
providing a consistent name for accessing the values held by objects in
<tt class="docutils literal">pynads</tt>. Some would say that it&#8217;s a silly idea, but it works! Every
class in <tt class="docutils literal">pynads</tt> is also slotted for memory reasons since it&#8217;s built
around the idea of not manipulating a container but creating a new&nbsp;one.</p>
<p>The only important thing to know about Container is that it defines
<tt class="docutils literal">v</tt> as a property which actually delagates to the <tt class="docutils literal">_get_val</tt> method.
Meaning that&#8217;s all that needs to be overriden to get multiple values out
of a&nbsp;container.</p>
<p>For most subclasses of Container, the provided <tt class="docutils literal">__init__</tt> is fine, but
it&#8217;s a-ok to override it as well as the only setup that happens is
setting a single attribute <tt class="docutils literal">_v</tt>.</p>
<pre class="code ipython3 literal-block">
<span class="kn">from</span> <span class="nn">pynads</span> <span class="k">import</span> <span class="n">Container</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Container</span><span class="p">):</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'age'</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>

    <span class="k">def</span> <span class="nf">_get_val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">'name'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">'age'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Person(name=</span><span class="si">{!s}</span><span class="s2">, age=</span><span class="si">{!s}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Alec&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
</pre>
<pre class="literal-block">
{'age': 26, 'name': 'Alec'}
</pre>
</div>
<div class="section" id="functors">
<h3>Functors</h3>
<p>Functors are data types that can be mapped over with the <tt class="docutils literal">fmap</tt>
method. But calling methods isn&#8217;t very Haskell like, so there&#8217;s an
operator that does the same thing: <tt class="docutils literal">%</tt>.</p>
<pre class="code ipython3 literal-block">
<span class="kn">from</span> <span class="nn">pynads</span> <span class="k">import</span> <span class="n">Functor</span>

<span class="k">class</span> <span class="nc">FmapPerson</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="n">Functor</span><span class="p">):</span>
    <span class="n">__slots__</span> <span class="o">=</span> <span class="p">()</span>
    <span class="k">def</span> <span class="nf">fmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span> <span class="o">%</span> <span class="n">FmapPerson</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Alec&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">26</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Person(name=ALEC, age=26)
</pre>
<p>Of course, you <em>could</em> just use <tt class="docutils literal">FmapPerson.fmap</tt> but that&#8217;s not very
Haskellic. <tt class="docutils literal">pynads</tt> also exports a <tt class="docutils literal">funcs</tt> name space that contains
functional shortcuts to some of these (though <tt class="docutils literal">f % functor</tt> doesn&#8217;t
get much shorter). In this case, there&#8217;s&nbsp;also:</p>
<pre class="code ipython3 literal-block">
<span class="kn">from</span> <span class="nn">pynads</span> <span class="k">import</span> <span class="n">funcs</span>

<span class="nb">print</span><span class="p">(</span><span class="n">funcs</span><span class="o">.</span><span class="n">fmap</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">,</span> <span class="n">FmapPerson</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Alec&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">26</span><span class="p">)))</span>
</pre>
<pre class="literal-block">
Person(name=ALEC, age=26)
</pre>
<p>Every class in the <tt class="docutils literal">pynads.concrete</tt> namespace is a functor except for
<tt class="docutils literal">Mempty</tt> (we&#8217;ll get&nbsp;there!).</p>
</div>
<div class="section" id="applicatives">
<h3>Applicatives</h3>
<p>Applicative Functors are functors that hold functions and can then be
applied to other Applicatives/Functors. Every class (except for
<tt class="docutils literal">Mempty</tt>) in <tt class="docutils literal">pynads.concrete</tt> is also an&nbsp;Applicative!</p>
<pre class="code ipython3 literal-block">
<span class="kn">from</span> <span class="nn">pynads</span> <span class="k">import</span> <span class="n">Just</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Just</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Just</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Just 4
</pre>
<p>Yeah, like Haskell there&#8217;s an infix operator. Except of <tt class="docutils literal">&lt;*&gt;</tt> I just
dropped the angle brackets because Python doesn&#8217;t let you define custom
operators (easily). It also combines nicely with <tt class="docutils literal">%</tt> because they have
the same precedence&nbsp;level!</p>
<pre class="code ipython3 literal-block">
<span class="nb">print</span><span class="p">((</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span> <span class="o">%</span> <span class="n">Just</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">Just</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Just 10
</pre>
<p><span class="caps">BOOM</span>! Mind blown! Whaaaaaat. Applicative uses the abstract method
<tt class="docutils literal">apply</tt> to determine how <tt class="docutils literal">*</tt> operates. Just inherit from
Applicative, define <tt class="docutils literal">fmap</tt> and <tt class="docutils literal">apply</tt> and boom, you&#8217;re on your way.
Well, you also need the <tt class="docutils literal">unit</tt> method &#8212; which is a class method for
all <tt class="docutils literal">pynad</tt> types, but that&#8217;s not a requirement &#8212; which knows how to
put a value in a minimal&nbsp;context.</p>
<p>But wait, what if you have a curried function and you stuffed it into a
Just and now you don&#8217;t want to write out
<tt class="docutils literal">just_f * just_v1 * just_v2 ...</tt>. Sure, you could think &#8220;Well, what if
I used <tt class="docutils literal">reduce(operator.mul, *justs)</tt>&#8221; But I thought of that&nbsp;already.</p>
<pre class="code ipython3 literal-block">
<span class="n">add_three_together</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">+</span><span class="n">z</span>

<span class="nb">print</span><span class="p">(</span><span class="n">funcs</span><span class="o">.</span><span class="n">multiapply</span><span class="p">(</span><span class="n">Just</span><span class="p">(</span><span class="n">add_three_together</span><span class="p">),</span> <span class="o">*</span><span class="p">[</span><span class="n">Just</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)]))</span>
</pre>
<pre class="literal-block">
Just 6
</pre>
<p>If you&#8217;re mind isn&#8217;t blown yet, it&#8217;s because I haven&#8217;t&nbsp;revealed&#8230;</p>
</div>
<div class="section" id="mooooooooonaaaaaaaads">
<h3><span class="caps">MOOOOOOOOONAAAAAAAADS</span>!!!!!</h3>
<p>Monads get a bad rap because they get all sorts of overblown
explainations. You want to know a what a monad is? It&#8217;s another way to
compute things. It&#8217;s a glorified container with a special method. You
have a value in a monad, a function that takes a regular value and
returns a monad and you bind them together. That&#8217;s it. Literally all
there is to&nbsp;it.</p>
<pre class="code ipython3 literal-block">
<span class="kn">from</span> <span class="nn">pynads</span> <span class="k">import</span> <span class="n">Nothing</span>

<span class="n">inc_if_odd_else_nothing</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Just</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">&amp;</span><span class="mi">1</span> <span class="k">else</span> <span class="n">Nothing</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Just</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">inc_if_odd_else_nothing</span><span class="p">)</span>
</pre>
<pre class="literal-block">
Just 3
</pre>
<p>The Maybe monad (which consists of the Just and Nothing data types) is
basically a glorified if expression. That&#8217;s it! The bind operation will
detect if you have a failure in your computation and short circuit it.
It&#8217;s essentially an abstraction over&nbsp;this:</p>
<pre class="code ipython3 literal-block">
<span class="k">def</span> <span class="nf">safe_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="n">safe_func</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">safe_func</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
</pre>
<pre class="literal-block">
2 None
</pre>
<p>Notice how that didn&#8217;t cause a nasty AttributeError, because None
doesn&#8217;t have attributes? That&#8217;s all Maybe lets you do (this behavior is
mimicked in its fmap and apply: <tt class="docutils literal">fmap(f, Nothing)</tt> and
<tt class="docutils literal">apply(ap_f, Nothing)</tt> both return you a Nothing). Nothing is
extraspecialsauce because it&#8217;s a singleton. It&#8217;s basically a monadic
None. Actually, it <em>is</em> a monadic None because it represents&#8230;well,&nbsp;Nothing.</p>
<p>If you&#8217;ve got more binds than editor columns, then there&#8217;s something for
you as&nbsp;well!</p>
<pre class="code ipython3 literal-block">
<span class="nb">print</span><span class="p">(</span><span class="n">multibind</span><span class="p">(</span><span class="n">Just</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="o">*</span><span class="n">repeat</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Just</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mi">5</span><span class="p">)))</span>
</pre>
<pre class="literal-block">
Just 6
</pre>
<p>Before you start thinking, &#8220;Well, monads are just glorified if
expressions&#8221; becuase that&#8217;s missing the point, Monads are the
abstraction abstraction. They represent a way to compute something by
abstracting away <em>how</em> it&#8217;s&nbsp;computated.</p>
<p>There&#8217;s the Writer monad above which is a value in a monadic context but
it also keeps some extra side-output as well. Instead of us trying to
track this extra information ourselves, Writer says, &#8220;Hey, I&#8217;ll handle
it for you!&#8221; It just wants a function that accepts a value and returns a
Writer. But here&#8217;s the really cool thing, I <em>didn&#8217;t</em> have to use a
dictionary. It could have a list, or a string or an integer, or a custom
class! I hear, &#8220;But how!&#8221; Through the power&nbsp;of&#8230;</p>
</div>
<div class="section" id="monoids">
<h3>Monoids!</h3>
<p>So monoids are pretty cool. They&#8217;re a set of something, a &#8220;zero&#8221; and a
binary operator that&#8217;s transative. Lots of things form monoids. Numbers
are monoids! There&#8217;s <em>two</em> ways to make numbers monoids: with <tt class="docutils literal">0</tt> and
<tt class="docutils literal">+</tt>, with <tt class="docutils literal">1</tt> and <tt class="docutils literal">*</tt>. However, <tt class="docutils literal">pynads</tt> is lazy and only
defines the first&#8230;sorry, hard choices were&nbsp;made.</p>
<p>Wait, &#8220;a zero value&#8221; but <tt class="docutils literal">1 != 0</tt>. That&#8217;s missing the point, a zero
value is a value that doesn&#8217;t change the input when combined with the
binary operator. <tt class="docutils literal">x * 1 == x</tt>.</p>
<p>But Python&#8217;s &#8220;primitive&#8221; types all form&nbsp;monads!</p>
<ul class="simple">
<li><tt class="docutils literal">list</tt> is a monoid. That&#8217;s the zero value right there and it&#8217;s
binary operator would be <tt class="docutils literal">list.extend</tt> if it was actually a&nbsp;binop.</li>
<li><tt class="docutils literal">dict</tt> is a monoid with <tt class="docutils literal">{}</tt> and <tt class="docutils literal">dict.update</tt></li>
<li><tt class="docutils literal">bool</tt> is a monoid with <tt class="docutils literal">False</tt> and <tt class="docutils literal">|</tt>\<tt class="docutils literal">or</tt></li>
<li><tt class="docutils literal">set</tt> and <tt class="docutils literal">frozenset</tt> are also monoids with their empty instances
and <tt class="docutils literal">|</tt></li>
<li><tt class="docutils literal">str</tt> is a monoid with <tt class="docutils literal">''</tt> and <tt class="docutils literal">+</tt> (boooo using <tt class="docutils literal">+</tt> to
combine strings! but&nbsp;whatever)</li>
</ul>
<p>Tuple, Complex and Float are also monoids in exactly the ways you
expect. There&#8217;s a catch though: When combining tuples, you actually get
a list back. I&#8217;ll probably rectify this at a later point, but it&#8217;s just
something to live with right&nbsp;now.</p>
<p><tt class="docutils literal">pynads</tt> also defines [<span class="caps">STRIKEOUT</span>:two] three monoids of its own:
<tt class="docutils literal">List</tt> (the monadic form of <tt class="docutils literal">tuple</tt>), <tt class="docutils literal">Map</tt> (the applicative form
of <tt class="docutils literal">dict</tt>) and <tt class="docutils literal">Mempty</tt> (which we&#8217;re getting&nbsp;to!).</p>
<p>Making your own monoid is easy, and you&#8217;ve probably done it before (just
not in this fashion). Just inherit from <tt class="docutils literal">pynads.Monoid</tt> create a
<tt class="docutils literal">mempty</tt> attribute (it won&#8217;t let you without it through <tt class="docutils literal">__new__</tt>
hackery) and the <tt class="docutils literal">mappend</tt> method for combining two instances of your
monoid. Let&#8217;s assume we want a <em>real</em> tuple Monoid. We&#8217;d do it like&nbsp;this:</p>
<pre class="code ipython3 literal-block">
<span class="kn">from</span> <span class="nn">pynads</span> <span class="k">import</span> <span class="n">Monoid</span>

<span class="c1"># also inherits from Container</span>
<span class="c1"># so we get all the Container goodness for free</span>
<span class="k">class</span> <span class="nc">MTuple</span><span class="p">(</span><span class="n">Monoid</span><span class="p">):</span>
    <span class="n">mempty</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">vs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MTuple</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mappend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># type checking optional</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MTuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can only mappend MTuple with MTuple&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">MTuple</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">v</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;MTuple</span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
</pre>
<pre class="code ipython3 literal-block">
<span class="nb">print</span><span class="p">(</span><span class="n">MTuple</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">MTuple</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
</pre>
<pre class="literal-block">
MTuple(4, 5, 6, 7)
</pre>
<p><tt class="docutils literal">pynads.Monoid</tt> overrides <tt class="docutils literal">+</tt> to be a shortcut to <tt class="docutils literal">mappend</tt>.
That&#8217;s all well and good, but <em>why</em> other than have a unified way of
combining values?! Because we get a way to reduce a list of monoids into
a single value for&nbsp;free!</p>
<pre class="code ipython3 literal-block">
<span class="nb">print</span><span class="p">(</span><span class="n">MTuple</span><span class="o">.</span><span class="n">mconcat</span><span class="p">(</span><span class="n">MTuple</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">MTuple</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">MTuple</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</pre>
<pre class="literal-block">
MTuple(1, 2, 3)
</pre>
<p><tt class="docutils literal">Monoid.mconcat</tt> actually delegates to the <tt class="docutils literal">mappend</tt> method and
essentially looks like <tt class="docutils literal">reduce(cls.mappend, monoids)</tt>. That&#8217;s it.
That&#8217;s all there is. But you can define your own <tt class="docutils literal">mconcat</tt> to get
performace bonuses if you need&nbsp;to.</p>
<pre class="code ipython3 literal-block">
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">chain</span>

<span class="k">class</span> <span class="nc">CMTuple</span><span class="p">(</span><span class="n">MTuple</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>

    <span class="nd">&#64;classmethod</span>
    <span class="k">def</span> <span class="nf">mconcat</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">MTuples</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CMTuple</span><span class="p">(</span><span class="o">*</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">MTuples</span><span class="p">))</span>
</pre>
<pre class="code ipython3 literal-block">
<span class="nb">print</span><span class="p">(</span><span class="n">CMTuple</span><span class="o">.</span><span class="n">mconcat</span><span class="p">(</span><span class="n">CMTuple</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">CMTuple</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">CMTuple</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</pre>
<pre class="literal-block">
MTuple(1, 2, 3)
</pre>
<p><tt class="docutils literal">pynads.List</tt> and <tt class="docutils literal">pynads.Map</tt> take advantage of this to create only
one intermediate object rather than a bunch. <tt class="docutils literal">pynads</tt> will also let
you treat the builtin types as monoids as well through
<tt class="docutils literal">pynads.funcs.monoid</tt> namespace which has four functions we&#8217;re
interested in: <tt class="docutils literal">mempty</tt>, <tt class="docutils literal">mappend</tt>, <tt class="docutils literal">mconcat</tt> and <tt class="docutils literal">is_monoid</tt>.
<tt class="docutils literal">mempty</tt> returns the &#8220;zero&#8221; value for a type, <tt class="docutils literal">mappend</tt> knows how to
combine types, <tt class="docutils literal">mconcat</tt> knows how to combine an iter of types into a
single one and <tt class="docutils literal">is_monoid</tt> knows if something is monoidal or not
(generally, it doesn&#8217;t declare <tt class="docutils literal">decimal.Decimal</tt> to be a monoid but
this is because I didn&#8217;t want to add a special case &#8212; special cases
beget special&nbsp;cases).</p>
<p>This is done through introspection of types and abstract base classes
(to make the type introspection [<span class="caps">STRIKEOUT</span>:more acceptable] less&nbsp;painful).</p>
<pre class="code ipython3 literal-block">
<span class="kn">from</span> <span class="nn">pynads.funcs</span> <span class="k">import</span> <span class="n">monoid</span>

<span class="nb">print</span><span class="p">(</span><span class="n">monoid</span><span class="o">.</span><span class="n">mempty</span><span class="p">(</span><span class="nb">list</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">monoid</span><span class="o">.</span><span class="n">mappend</span><span class="p">({</span><span class="s1">'a'</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s1">'b'</span><span class="p">:</span> <span class="mi">7</span><span class="p">}))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">monoid</span><span class="o">.</span><span class="n">mconcat</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">monoid</span><span class="o">.</span><span class="n">is_monoid</span><span class="p">(</span><span class="nb">set</span><span class="p">()))</span>
</pre>
<pre class="literal-block">
[]
{'a': 10, 'b': 7}
hello world
True
</pre>
<p>The monoid namespace is just a nice interface to the nasty plumbing that
lives in <tt class="docutils literal">pynads.utils.monoidal</tt>. It&#8217;s pretty gross and actually
probably pretty fragile, but it works! <span class="caps">IT</span> <span class="caps">WORKS</span>!!!</p>
<div class="section" id="mempty">
<h4>Mempty</h4>
<p>So here&#8217;s the thing that lets <tt class="docutils literal">Writer</tt> do its little trick by accept
any monoid as a potential log. I can&#8217;t know ahead of time what you&#8217;re
going to use to keep track of stuff with <tt class="docutils literal">Writer</tt> &#8212; I&#8217;ve drank plenty
of spice water, but I&#8217;ve yet to develop prescient abilities. And rather
than making a bunch of subclasses specialized to handle a dictionary and
a list and a string and a blah blah blah and forcing you to make your
own for <tt class="docutils literal">WriterLogWithMyFirstMonoid</tt> I decided to create a mempty
monoid &#8212; <tt class="docutils literal">Mempty</tt>. It&#8217;s not an original idea. Really, it&#8217;s kind of a
dumb&nbsp;object.</p>
<p>It&#8217;s a singleton, so that&#8217;s a strike against it (two singletons in my
library, my god!). It doesn&#8217;t actually <em>do</em> anything. It just sits
around, taking up space until a real monoid comes along and scares it
off. It&#8217;s mempty value is actually itself! It&#8217;s mappend just returns
whatever its mappended with. And it&#8217;s mconcat filters out any Mempty
values before trying to mconcat the remaining values (you get a Mempty
if mconcat an iter of Mempties). There&#8217;s even an <tt class="docutils literal">__iter__</tt> method
that yields from an empty tuple! What&#8217;s going&nbsp;on!</p>
<p>In Haskell, <tt class="docutils literal">mempty</tt> can be used a place holder and Haskell knows to
do the right thing already. However, we have to teach Python how to use
a placeholder and silently step it out of the way when a real value
comes along. I suspect that this is similar, maybe, to how Haskell
handles it, but I&#8217;ve not dug at&nbsp;all.</p>
<pre class="code ipython3 literal-block">
<span class="kn">from</span> <span class="nn">pynads</span> <span class="k">import</span> <span class="n">Mempty</span>

<span class="nb">print</span><span class="p">(</span><span class="n">monoid</span><span class="o">.</span><span class="n">mempty</span><span class="p">(</span><span class="n">Mempty</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Mempty</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">monoid</span><span class="o">.</span><span class="n">mconcat</span><span class="p">(</span><span class="n">Mempty</span><span class="p">,</span> <span class="p">{</span><span class="mi">4</span><span class="p">},</span> <span class="p">{</span><span class="mi">5</span><span class="p">},</span> <span class="n">Mempty</span><span class="p">))</span>
</pre>
<pre class="literal-block">
Mempty
4
{4, 5}
</pre>
<p>So Writer&#8217;s little trick of allowing any Monoid be the log is really
just, &#8220;I have this dumb thing that pretends to be a Monoid as a default&nbsp;log.&#8221;</p>
</div>
</div>
<div class="section" id="helpers">
<h3>Helpers</h3>
<p>I won&#8217;t explore this section indepth because <tt class="docutils literal">pynads.funcs</tt> has a
whole host of helpers, with more being added as needed. There&#8217;s helpers
for making constants, composing functions, an identity function (as in
<tt class="docutils literal">lambda x: x</tt> not <tt class="docutils literal">id(x)</tt>), turning values into Monads. There&#8217;s also
<tt class="docutils literal">pynads.utils</tt> if you need to plumb some of the internal workings like
compatibility (did I mention all the tests pass 3.4 and 2.7?!) or how
monoids are determined on things that aren&#8217;t explicitly&nbsp;monoids.</p>
</div>
<div class="section" id="that-s-it">
<h3>That&#8217;s&nbsp;it!</h3>
<p>Well, not really. There&#8217;s about five other monads implemented that I
didn&#8217;t cover (like Reader, which was a pain but also a lot of fun to
implement). There&#8217;s more coming as well. Not just monads, but other
things. A proof of concept for do notation via abusing coroutines exists
in the repo (lifted from a blog called <a class="reference external" href="http://www.valuedlessons.com/2008/01/monads-in-python-with-nice-syntax.html">Valued
Lessons</a>
which served as partial inspiration for this project). And maybe Monad
Transformers if I work the gumption up for it (probably yes). And who
knows what&nbsp;else.</p>
</div>
</div>

            <aside>
            <nav>
            <ul class="articles_timeline">
 
                <li class="previous_article">« <a href="http://justanr.github.io/musings-on-problem-solving" title="Previous: Musings on Problem&nbsp;Solving">Musings on Problem&nbsp;Solving</a></li>
 
                <li class="next_article"><a href="http://justanr.github.io/crazy-ideas-and-i" title="Next: Crazy Ideas and&nbsp;I">Crazy Ideas and&nbsp;I</a> »</li>
            </ul>
            </nav>
            </aside>
<section>
<hr/>
<p id="comment-message">I spilled my brains, spill some of yours. </p>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2" 
                href="http://justanr.github.io/fizzbuzz-with-pynads/#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'ballinoctobear';
        var disqus_identifier = 'http://justanr.github.io/fizzbuzz-with-pynads';
    var disqus_url = 'http://justanr.github.io/fizzbuzz-with-pynads';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>                </div>
            </div>
        </div>
    </div>
</div>
</section>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2015-04-06T00:00:00-04:00">Apr 6, 2015</time>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#libraries-ref">libraries</a> 
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#haskell-ref">haskell
                    <span>3</span>
</a></li>
                <li><a href="/tags.html#pynads-ref">pynads
                    <span>3</span>
</a></li>
                <li><a href="/tags.html#python-ref">python
                    <span>15</span>
</a></li>
            </ul>

        </div>
        </section>
    </div>
    </article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-license">Shared under the Creative Commons for content and MIT for code</li>
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

<script type="text/javascript">
    var disqus_shortname = 'ballinoctobear';

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
    </body>
</html>